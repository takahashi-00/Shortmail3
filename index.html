<!DOCTYPE html>
<html lang="ja" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç¢„Éï„Çø„ÉºÁÇπÊ§ú„É°„Éº„É´‰ΩúÊàê„ÉÑ„Éº„É´</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans JP', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'bounce-slight': 'bounceSlight 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        bounceSlight: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-3px)' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
        /* „Çπ„ÇØ„É≠„Éº„É´„Éê„ÉºË®≠ÂÆö */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* „Éï„Ç©„Éº„Ç´„ÇπÊôÇ„ÅÆ„É™„É≥„Ç∞Ë™øÊï¥ */
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #ec4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.2);
        }
        
        /* „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ËÉåÊôØ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .bg-animate {
            background-size: 200% 200%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-cyan-100 dark:from-slate-900 dark:via-purple-950 dark:to-slate-900 text-slate-700 dark:text-slate-100 min-h-screen transition-colors duration-500 selection:bg-pink-400 selection:text-white bg-animate">

    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-white/40 dark:border-slate-700/50 sticky top-0 z-50 shadow-sm transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-tr from-pink-500 to-violet-500 p-2.5 rounded-2xl text-white shadow-lg shadow-pink-500/30 transform transition-transform hover:scale-110 hover:rotate-3 duration-300">
                    <i data-lucide="send" class="w-5 h-5"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-violet-600 dark:from-pink-400 dark:to-violet-400 tracking-tight leading-none">After Support Mailer</h1>
                    <p class="text-xs text-slate-500 dark:text-slate-400 font-bold mt-1 tracking-wide">Ê°ßÂÆ∂‰ΩèÂÆÖ ÂüºÁéâÂåóÂ∑•‰∫ãÈÉ®</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <!-- „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂàáÊõø -->
                <button onclick="toggleDarkMode()" class="p-2.5 rounded-full text-slate-500 hover:text-violet-600 dark:text-slate-400 dark:hover:text-violet-300 hover:bg-white/60 dark:hover:bg-slate-700 transition-all focus:outline-none focus:ring-2 focus:ring-violet-400/50 active:scale-95" title="„ÉÜ„Éº„ÉûÂàáÊõø">
                    <i data-lucide="moon" class="w-5 h-5 block dark:hidden"></i>
                    <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                </button>
                <!-- „É™„Çª„ÉÉ„Éà -->
                <button onclick="resetForm()" class="p-2.5 rounded-full text-slate-500 hover:text-rose-500 hover:bg-rose-50 dark:text-slate-400 dark:hover:bg-rose-900/20 transition-all focus:outline-none focus:ring-2 focus:ring-rose-400/50 active:scale-95" title="„É™„Çª„ÉÉ„Éà">
                    <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-6 lg:py-10 space-y-6">

        <!-- „É¢„Éº„ÉâÂàá„ÇäÊõø„Åà„Çø„Éñ -->
        <nav class="grid grid-cols-3 gap-2 sm:gap-4">
            <button onclick="setMode('normal')" id="tabNormal" class="group relative flex flex-col items-center justify-center py-4 rounded-xl border-2 transition-all duration-200 bg-white/70 dark:bg-slate-800/80 border-pink-500 text-pink-600 dark:text-pink-400 font-bold shadow-sm hover:border-pink-300">
                <span class="text-sm">ÈÄöÂ∏∏„É°„Éº„É´</span>
            </button>
            <button onclick="setMode('sms')" id="tabSms" class="group relative flex flex-col items-center justify-center py-4 rounded-xl border-2 transition-all duration-200 bg-white/40 dark:bg-slate-800/40 border-transparent text-slate-500 dark:text-slate-400 hover:border-slate-300 dark:hover:border-slate-600 hover:bg-white/60">
                <span class="text-sm">‰∫ãÂâçÁ¢∫Ë™çSMS</span>
            </button>
            <button onclick="setMode('custom')" id="tabCustom" class="group relative flex flex-col items-center justify-center py-4 rounded-xl border-2 transition-all duration-200 bg-white/40 dark:bg-slate-800/40 border-transparent text-slate-500 dark:text-slate-400 hover:border-slate-300 dark:hover:border-slate-600 hover:bg-white/60">
                <div class="flex items-center gap-1.5">
                    <i data-lucide="sparkles" class="w-4 h-4 text-violet-500 group-hover:scale-110 transition-transform"></i>
                    <span class="text-sm">AI„Éó„É≠„É≥„Éó„Éà</span>
                </div>
            </button>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <!-- Â∑¶„Ç´„É©„É†ÔºöÂÖ•Âäõ„Éï„Ç©„Éº„É† -->
            <div class="lg:col-span-7 space-y-6">
                
                <!-- ÂÖ±ÈÄöÔºöÂü∫Êú¨ÊÉÖÂ†±ÔºàÂ∏∏„Å´Ë°®Á§∫Ôºâ -->
                <div class="bg-white/70 dark:bg-slate-800/80 backdrop-blur-md rounded-3xl shadow-xl shadow-purple-500/5 dark:shadow-black/40 border border-white/60 dark:border-slate-700/50 overflow-hidden transition-all duration-300 hover:shadow-purple-500/10">
                    <div class="bg-gradient-to-r from-pink-50/80 to-purple-50/80 dark:from-pink-900/20 dark:to-purple-900/20 px-6 py-4 border-b border-pink-100/50 dark:border-pink-800/30 flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full bg-pink-100 dark:bg-pink-900/50 flex items-center justify-center text-pink-500 dark:text-pink-300">
                            <i data-lucide="user-circle" class="w-5 h-5"></i>
                        </div>
                        <h2 class="text-base font-bold text-slate-700 dark:text-slate-200">Âü∫Êú¨ÊÉÖÂ†±Ë®≠ÂÆö</h2>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- È°ßÂÆ¢Âêç -->
                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-pink-500/80 dark:text-pink-400/80 uppercase tracking-wider ml-1">È°ßÂÆ¢Âêç <span class="text-rose-500">*</span></label>
                                <div class="relative group">
                                    <i data-lucide="user" class="absolute left-3 top-2.5 text-slate-400 dark:text-slate-500 w-5 h-5 group-focus-within:text-pink-500 transition-colors"></i>
                                    <input type="text" id="customerName" placeholder="‰æãÔºöÂ±±Áî∞ Â§™ÈÉé" 
                                        class="w-full pl-10 pr-4 py-2.5 bg-white/50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-800 dark:text-white transition-all placeholder:text-slate-400 shadow-sm focus:bg-white dark:focus:bg-slate-700"
                                        oninput="updatePreview()">
                                </div>
                            </div>

                            <!-- ÊãÖÂΩìËÄÖÂêç -->
                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-purple-500/80 dark:text-purple-400/80 uppercase tracking-wider ml-1">ÊãÖÂΩìËÄÖÂêç <span class="text-rose-500">*</span></label>
                                <div class="relative group">
                                    <i data-lucide="briefcase" class="absolute left-3 top-2.5 text-slate-400 dark:text-slate-500 w-5 h-5 group-focus-within:text-purple-500 transition-colors"></i>
                                    <input type="text" id="staffName" value="Áïë" placeholder="ÊãÖÂΩìËÄÖÂêç"
                                        class="w-full pl-10 pr-4 py-2.5 bg-white/50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-800 dark:text-white transition-all shadow-sm focus:bg-white dark:focus:bg-slate-700"
                                        oninput="updatePreview()">
                            </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „É¢„Éº„ÉâÂà•ÂÖ•Âäõ„Ç®„É™„Ç¢„ÅÆ„Ç≥„É≥„ÉÜ„Éä -->
                <div id="modeSettingsContainer" class="space-y-6 min-h-[400px]">
                    
                    <!-- 1. ÈÄöÂ∏∏„Éª‰∫ãÂâçÁ¢∫Ë™ç„É¢„Éº„ÉâÁî®Ë®≠ÂÆö („Éá„Éï„Ç©„É´„ÉàË°®Á§∫) -->
                    <div id="normalSettings" class="space-y-6 animate-fade-in">
                        
                        <!-- ÁÇπÊ§úË©≥Á¥∞„Ç´„Éº„Éâ (SMS„É¢„Éº„ÉâÊôÇ„ÅØÈùûË°®Á§∫) -->
                        <div id="inspectionDetailsCard" class="bg-white/70 dark:bg-slate-800/80 backdrop-blur-md rounded-3xl shadow-xl shadow-purple-500/5 dark:shadow-black/40 border border-white/60 dark:border-slate-700/50 overflow-hidden transition-all duration-300 hover:shadow-purple-500/10">
                            <div class="bg-gradient-to-r from-blue-50/80 to-cyan-50/80 dark:from-blue-900/20 dark:to-cyan-900/20 px-6 py-4 border-b border-blue-100/50 dark:border-blue-800/30 flex items-center justify-between">
                                 <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-blue-500 dark:text-blue-300">
                                        <i data-lucide="clipboard-list" class="w-5 h-5"></i>
                                    </div>
                                    <h2 class="text-base font-bold text-slate-700 dark:text-slate-200">ÁÇπÊ§ú„Éª‰∏çÂÖ∑ÂêàË©≥Á¥∞</h2>
                                </div>
                                <span class="text-[10px] bg-white/80 dark:bg-slate-700 px-2 py-1 rounded-full text-slate-500 dark:text-slate-300 font-bold border border-slate-100 dark:border-slate-600">ÂÆöÂûã„É¢„Éº„Éâ</span>
                            </div>
                            
                            <div class="p-6 space-y-6">
                                <!-- ÁÇπÊ§úÁ®ÆÂà• -->
                                <div class="space-y-1.5">
                                    <label class="text-xs font-bold text-blue-500/80 dark:text-blue-400/80 uppercase tracking-wider ml-1">ÁÇπÊ§úÁ®ÆÂà•</label>
                                    <div class="relative">
                                        <select id="inspectionType" class="w-full px-4 py-2.5 bg-white/50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-800 dark:text-white appearance-none cursor-pointer transition-all focus:bg-white dark:focus:bg-slate-700 shadow-sm"
                                            onchange="toggleCustomInspection(); updatePreview()">
                                            <option value="6„ÅãÊúà">6„ÅãÊúàÁÇπÊ§ú</option>
                                            <option value="2Âπ¥">2Âπ¥ÁÇπÊ§ú</option>
                                            <option value="„Åù„ÅÆ‰ªñ">„Åù„ÅÆ‰ªñÔºàÊâãÂÖ•ÂäõÔºâ</option>
                                        </select>
                                        <div class="absolute right-3 top-3 pointer-events-none text-slate-400">
                                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                        </div>
                                    </div>
                                    <div id="customInspectionWrapper" class="hidden mt-2">
                                        <input type="text" id="customInspectionType" placeholder="‰æãÔºö1Âπ¥ÁÇπÊ§ú„ÄÅËá®ÊôÇÁÇπÊ§ú„Å™„Å©"
                                            class="w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-xl text-slate-800 dark:text-white transition-all"
                                            oninput="updatePreview()">
                                    </div>
                                </div>

                                <!-- ‰∏çÂÖ∑ÂêàÂÜÖÂÆπ -->
                                <div class="space-y-1.5">
                                    <label class="text-xs font-bold text-amber-500/80 dark:text-amber-400/80 uppercase tracking-wider ml-1">‰∏çÂÖ∑Âêà„ÉªÊåáÊëòÂÜÖÂÆπ</label>
                                    <div class="relative group">
                                        <i data-lucide="alert-triangle" class="absolute left-3 top-3 text-slate-400 dark:text-slate-500 w-5 h-5 group-focus-within:text-amber-500 transition-colors"></i>
                                        <textarea id="issueDetail" placeholder="‰æãÔºö„ÇØ„É≠„Çπ„ÅÆÂâ•„Åå„Çå„ÄÅÂª∫ÂÖ∑„ÅÆË™øÊï¥" rows="3"
                                            class="w-full pl-10 pr-4 py-2.5 bg-white/50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-800 dark:text-white resize-none transition-all focus:bg-white dark:focus:bg-slate-700 shadow-sm"
                                            oninput="updatePreview()"></textarea>
                                    </div>
                                </div>

                                <!-- „ÅäË©´„Å≥„Éï„É©„Ç∞ -->
                                <div class="flex items-center justify-between bg-orange-50/60 dark:bg-orange-900/20 p-3 rounded-xl border border-orange-100 dark:border-orange-800/30 transition-colors hover:bg-orange-50 dark:hover:bg-orange-900/30 group cursor-pointer" onclick="document.getElementById('needsApology').click()">
                                    <div class="flex items-center gap-3">
                                        <div class="bg-white dark:bg-orange-900/40 p-2 rounded-lg text-orange-500 dark:text-orange-400 shadow-sm">
                                            <i data-lucide="heart-handshake" class="w-5 h-5"></i>
                                        </div>
                                        <div>
                                            <div class="text-sm font-bold text-orange-900 dark:text-orange-200">„ÅäË©´„Å≥Êñá„ÇíÊåøÂÖ•</div>
                                            <div class="text-xs text-orange-700/70 dark:text-orange-300/60">ÈÅÖÂª∂ÊôÇ„Å™„Å©„Å´‰ΩøÁî®</div>
                                        </div>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer pointer-events-none">
                                        <input type="checkbox" id="needsApology" class="sr-only peer" onchange="updatePreview()">
                                        <div class="w-10 h-6 bg-slate-300 dark:bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:shadow-sm after:transition-all peer-checked:bg-orange-500"></div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Ë®™Âïè„ÉªÊó•Á®ãË™øÊï¥„Ç´„Éº„Éâ -->
                        <div class="bg-white/70 dark:bg-slate-800/80 backdrop-blur-md rounded-3xl shadow-xl shadow-purple-500/5 dark:shadow-black/40 border border-white/60 dark:border-slate-700/50 overflow-hidden transition-all duration-300 hover:shadow-purple-500/10">
                            <div class="bg-gradient-to-r from-emerald-50/80 to-teal-50/80 dark:from-emerald-900/20 dark:to-teal-900/20 px-6 py-4 border-b border-emerald-100/50 dark:border-emerald-800/30 flex items-center gap-2">
                                <div class="w-8 h-8 rounded-full bg-emerald-100 dark:bg-emerald-900/50 flex items-center justify-center text-emerald-500 dark:text-emerald-300">
                                    <i data-lucide="calendar-clock" class="w-5 h-5"></i>
                                </div>
                                <h2 class="text-base font-bold text-slate-700 dark:text-slate-200">Ë®™Âïè„ÉªÊó•Á®ãË™øÊï¥</h2>
                            </div>

                            <div class="p-6 space-y-6">
                                <!-- Ë®™ÂïèÁêÜÁî± -->
                                <div class="space-y-1.5">
                                    <label class="text-xs font-bold text-emerald-500/80 dark:text-emerald-400/80 uppercase tracking-wider ml-1">Ë®™ÂïèÁêÜÁî±</label>
                                    <div class="grid grid-cols-2 gap-3">
                                        <label class="cursor-pointer relative">
                                            <input type="radio" name="visitReason" value="‰øÆÁπï‰ΩúÊ•≠" checked class="peer hidden" onchange="updatePreview()">
                                            <div class="text-center py-3 px-4 rounded-xl border-2 transition-all duration-200 bg-white/50 dark:bg-slate-700/50 border-slate-200 dark:border-slate-600 text-slate-500 dark:text-slate-400 peer-checked:bg-blue-50/90 dark:peer-checked:bg-blue-900/40 peer-checked:border-blue-500 dark:peer-checked:border-blue-400 peer-checked:text-blue-600 dark:peer-checked:text-blue-300 peer-checked:font-bold peer-checked:shadow-sm hover:border-slate-300 dark:hover:border-slate-500 flex items-center justify-center gap-2">
                                                <i data-lucide="wrench" class="w-4 h-4"></i> ‰øÆÁπï‰ΩúÊ•≠
                                            </div>
                                        </label>
                                        <label class="cursor-pointer relative">
                                            <input type="radio" name="visitReason" value="ÁèæÂú∞Ë™øÊüª" class="peer hidden" onchange="updatePreview()">
                                            <div class="text-center py-3 px-4 rounded-xl border-2 transition-all duration-200 bg-white/50 dark:bg-slate-700/50 border-slate-200 dark:border-slate-600 text-slate-500 dark:text-slate-400 peer-checked:bg-emerald-50/90 dark:peer-checked:bg-emerald-900/40 peer-checked:border-emerald-500 dark:peer-checked:border-emerald-400 peer-checked:text-emerald-600 dark:peer-checked:text-emerald-300 peer-checked:font-bold peer-checked:shadow-sm hover:border-slate-300 dark:hover:border-slate-500 flex items-center justify-center gap-2">
                                                <i data-lucide="search" class="w-4 h-4"></i> ÁèæÂú∞Ë™øÊüª
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- ÂÄôË£úÊó•ÂÖ•Âäõ„Ç®„É™„Ç¢ -->
                                <div class="space-y-1.5">
                                    <div class="flex justify-between items-end mb-1">
                                        <label class="text-xs font-bold text-emerald-500/80 dark:text-emerald-400/80 uppercase tracking-wider ml-1">Êó•ÊôÇË®≠ÂÆö</label>
                                        <button onclick="clearCandidates()" id="clearBtn" class="hidden text-xs text-rose-400 hover:text-rose-600 flex items-center gap-1 transition-colors px-2 py-1 rounded hover:bg-rose-50 dark:hover:bg-rose-900/20 font-bold">
                                            <i data-lucide="trash-2" class="w-3 h-3"></i> „ÇØ„É™„Ç¢
                                        </button>
                                    </div>
                                    
                                    <!-- „Ç´„É¨„É≥„ÉÄ„Éº„ÉÑ„Éº„É´ -->
                                    <div class="flex flex-wrap items-end gap-2 mb-3 p-3 bg-white/50 dark:bg-slate-700/30 rounded-xl border border-slate-200 dark:border-slate-600 shadow-sm">
                                        <div class="flex-1 min-w-[130px]">
                                            <label class="text-[10px] font-bold text-slate-400 dark:text-slate-500 mb-1 block uppercase">Êó•‰ªò</label>
                                            <input type="date" id="dateInput" class="w-full px-3 py-2 bg-white dark:bg-slate-600 border border-slate-200 dark:border-slate-500 rounded-lg text-sm text-slate-700 dark:text-white transition-all focus:ring-2 focus:ring-emerald-500/50">
                                        </div>
                                        <div class="w-[100px]">
                                            <label class="text-[10px] font-bold text-slate-400 dark:text-slate-500 mb-1 block uppercase">ÈñãÂßãÊôÇÈñì</label>
                                            <div class="relative">
                                                <select id="timeInput" class="w-full pl-2 pr-2 py-2 bg-white dark:bg-slate-600 border border-slate-200 dark:border-slate-500 rounded-lg text-sm text-slate-700 dark:text-white appearance-none cursor-pointer text-center focus:ring-2 focus:ring-emerald-500/50">
                                                    <option value="09:00">09:00</option>
                                                    <option value="10:00" selected>10:00</option>
                                                    <option value="11:00">11:00</option>
                                                    <option value="13:00">13:00</option>
                                                    <option value="14:00">14:00</option>
                                                    <option value="15:00">15:00</option>
                                                    <option value="16:00">16:00</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button onclick="addCandidateDate()" id="addBtn" disabled class="h-[38px] px-3 bg-slate-800 dark:bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-slate-700 dark:hover:bg-emerald-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 shadow-md active:scale-95">
                                            <i data-lucide="plus" class="w-4 h-4"></i>
                                        </button>
                                    </div>

                                    <textarea id="candidateDates" rows="4" placeholder="ÂÄôË£úÊó•„ÄÅ„Åæ„Åü„ÅØÁ¢∫ÂÆöÊó•ÊôÇ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"
                                        class="w-full p-4 bg-white/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-700 dark:text-white font-mono text-sm shadow-sm transition-all placeholder:text-slate-400 focus:bg-white dark:focus:bg-slate-800"
                                        oninput="updatePreview(); toggleClearBtn()"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. AI„Éó„É≠„É≥„Éó„ÉàÁîüÊàê„É¢„Éº„ÉâÁî®Ë®≠ÂÆö -->
                    <div id="customSettings" class="hidden space-y-6 animate-fade-in">
                        <div class="bg-white/70 dark:bg-slate-800/80 backdrop-blur-md rounded-3xl shadow-xl shadow-purple-500/5 dark:shadow-black/40 border border-white/60 dark:border-slate-700/50 overflow-hidden transition-all duration-300 hover:shadow-purple-500/10">
                            <div class="bg-gradient-to-r from-violet-50/80 to-fuchsia-50/80 dark:from-violet-900/20 dark:to-fuchsia-900/20 px-6 py-4 border-b border-violet-100/50 dark:border-violet-800/30 flex items-center gap-2">
                                 <div class="w-8 h-8 rounded-full bg-violet-100 dark:bg-violet-900/50 flex items-center justify-center text-violet-500 dark:text-violet-300">
                                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                                </div>
                                <h2 class="text-base font-bold text-slate-700 dark:text-slate-200">AI„Éó„É≠„É≥„Éó„ÉàÁîüÊàê</h2>
                            </div>
                            
                            <div class="p-6 space-y-6">
                                <div class="bg-violet-50/60 dark:bg-violet-900/10 p-4 rounded-2xl text-sm text-slate-600 dark:text-slate-300 leading-relaxed border border-violet-100 dark:border-violet-800/30">
                                    <span class="font-bold text-violet-600 dark:text-violet-400 block mb-1">üí° „Éí„É≥„Éà</span>
                                    ChatGPT„ÇÑGeminiÁ≠â„ÅÆ‰ªñ„ÅÆAI„Å´„ÄÅÈÅ©Âàá„Å™„Ç∑„Éß„Éº„Éà„É°„Éº„É´„Çí‰ΩúÊàê„Åó„Å¶„ÇÇ„Çâ„ÅÜ„Åü„ÇÅ„ÅÆ<strong>„ÄåÊåáÁ§∫ÊñáÔºà„Éó„É≠„É≥„Éó„ÉàÔºâ„Äç</strong>„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ<br>
                                    ÂÆõÂêç„ÇÑÊãÖÂΩìËÄÖÂêç„ÅØÂü∫Êú¨ÊÉÖÂ†±„Åå‰ΩøÁî®„Åï„Çå„Çã„Åü„ÇÅ„ÄÅ„Åì„Åì„Åß„ÅØ<strong>„ÄåÁõ∏Êâã„Å´‰ºù„Åà„Åü„ÅÑ„Åì„Å®„Äç</strong>„Å†„Åë„ÇíÁÆáÊù°Êõ∏„Åç„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                </div>

                                <!-- Ëá™Áî±ÂÖ•ÂäõÁî®‰ª∂ -->
                                <div class="space-y-1.5">
                                    <label class="text-xs font-bold text-violet-500/80 dark:text-violet-400/80 uppercase tracking-wider ml-1">‰ºù„Åà„Åü„ÅÑË¶Å‰ª∂Ôºà„É°„É¢Êõ∏„Åç„ÅßOKÔºâ <span class="text-rose-500">*</span></label>
                                    <div class="relative group">
                                        <textarea id="customMessage" placeholder="‰æãÔºö&#13;&#10;„ÉªÊù•ÈÄ±„ÅÆÊúàÊõúÊó•„Å´ÈõªË©±„Åó„Åü„ÅÑ&#13;&#10;„ÉªÊôÇÈñì„ÅØ10ÊôÇ„Åã„Çâ12ÊôÇ„ÅÆÈñì„Åå„ÅÑ„ÅÑ&#13;&#10;„ÉªÈÉΩÂêà„ÅåÊÇ™„Åë„Çå„Å∞Êïô„Åà„Å¶„Åª„Åó„ÅÑ" rows="8"
                                            class="w-full p-4 bg-white/50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-800 dark:text-white resize-none transition-all focus:bg-white dark:focus:bg-slate-700 shadow-sm leading-relaxed"
                                            oninput="updatePreview()"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Âè≥„Ç´„É©„É†Ôºö„Éó„É¨„Éì„É•„Éº -->
            <div class="lg:col-span-5 space-y-6 lg:sticky lg:top-24">
                
                <div class="flex items-center justify-between px-1">
                    <h2 class="text-sm font-bold text-slate-500 dark:text-slate-300 uppercase tracking-wider flex items-center gap-2">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                        Preview / Prompt
                    </h2>
                    
                    <!-- „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç¢„É©„Éº„Éà -->
                    <div id="nameAlert" class="hidden flex items-center gap-1.5 text-xs font-bold text-white bg-rose-500 px-3 py-1.5 rounded-full shadow-lg shadow-rose-500/30 animate-bounce-slight transition-all duration-300 transform">
                        <i data-lucide="alert-circle" class="w-3 h-3"></i>
                        <span id="alertText">È°ßÂÆ¢Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span>
                    </div>
                </div>

                <div class="relative group h-[calc(100vh-180px)] min-h-[500px]">
                    <!-- ËÉåÊôØ„ÅÆË£ÖÈ£æÔºà„Ç∞„É≠„ÉºÂäπÊûúÔºâ -->
                    <div id="previewGlow" class="absolute -inset-1 bg-gradient-to-br from-pink-500 to-violet-600 rounded-[20px] opacity-20 blur-xl group-hover:opacity-30 transition duration-1000"></div>
                    
                    <div class="relative bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/60 dark:border-slate-600/50 overflow-hidden transition-colors duration-300 flex flex-col h-full">
                        
                        <!-- MacÈ¢®„Éó„É¨„Éì„É•„Éº„Éò„ÉÉ„ÉÄ„Éº -->
                        <div class="bg-gray-100/80 dark:bg-slate-800/80 border-b border-gray-200 dark:border-slate-700 px-4 py-3 flex items-center justify-between h-12 flex-shrink-0">
                            <div class="flex gap-2 opacity-100 group/btns">
                                <div class="w-3 h-3 rounded-full bg-[#ff5f57] border border-[#e0443e] shadow-sm hover:brightness-90 transition-all"></div>
                                <div class="w-3 h-3 rounded-full bg-[#febc2e] border border-[#d89e24] shadow-sm hover:brightness-90 transition-all"></div>
                                <div class="w-3 h-3 rounded-full bg-[#28c840] border border-[#1aab29] shadow-sm hover:brightness-90 transition-all"></div>
                            </div>
                            <span id="previewLabel" class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest select-none">
                                ÈÄöÂ∏∏„É°„Éº„É´„Éó„É¨„Éì„É•„Éº
                            </span>
                            <div class="w-14"></div> <!-- „Çπ„Éö„Éº„Çµ„Éº -->
                        </div>

                        <!-- „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢ -->
                        <textarea id="generatedText" readonly
                            class="w-full flex-1 p-6 bg-transparent resize-none font-mono text-sm leading-relaxed focus:outline-none text-slate-700 dark:text-slate-300 selection:bg-pink-100 dark:selection:bg-pink-900/30 overflow-y-auto"></textarea>
                    </div>
                    
                    <!-- „Ç≥„Éî„Éº„Éú„Çø„É≥ -->
                    <div class="absolute bottom-6 right-6 z-10">
                        <button onclick="handleCopy()" id="copyBtn" disabled
                            class="flex items-center gap-2 px-6 py-3.5 rounded-full font-bold shadow-lg shadow-pink-500/30 transition-all transform hover:-translate-y-1 active:scale-95 bg-gradient-to-r from-pink-500 to-violet-600 text-white hover:shadow-xl hover:shadow-pink-500/40 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none grayscale disabled:grayscale ring-4 ring-white/30 dark:ring-black/30 backdrop-blur-sm">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                            <span class="tracking-wide" id="copyBtnText">COPY</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();
        let currentMode = 'normal';
        
        // „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂàùÊúüÂåñ („Éá„Éï„Ç©„É´„Éà„ÅØ„É©„Ç§„Éà)
        if (localStorage.theme === 'dark') {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        }

        // „É™„Çª„ÉÉ„ÉàÊ©üËÉΩÔºöJS„ÅßÂº∑Âà∂„ÇØ„É™„Ç¢
        function resetForm() {
            if (!confirm('ÂÖ•ÂäõÂÜÖÂÆπ„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) return;

            // ÂêÑÂÖ•ÂäõÈ†ÖÁõÆ„Çí„ÇØ„É™„Ç¢
            document.getElementById('customerName').value = '';
            document.getElementById('staffName').value = 'Áïë'; // „Éá„Éï„Ç©„É´„ÉàÂÄ§
            document.getElementById('inspectionType').value = '6„ÅãÊúà';
            document.getElementById('customInspectionType').value = '';
            document.getElementById('issueDetail').value = '';
            document.getElementById('needsApology').checked = false;
            
            // „É©„Ç∏„Ç™„Éú„Çø„É≥
            const visitRadios = document.getElementsByName('visitReason');
            for(const r of visitRadios) {
                if(r.value === '‰øÆÁπï‰ΩúÊ•≠') r.checked = true;
            }

            // Êó•ÊôÇ
            document.getElementById('dateInput').value = '';
            document.getElementById('timeInput').value = '10:00';
            document.getElementById('candidateDates').value = '';
            
            // Custom Message
            document.getElementById('customMessage').value = '';

            // UI„É™„Çª„ÉÉ„Éà
            document.getElementById('customInspectionWrapper').classList.add('hidden');
            toggleClearBtn();
            
            // „É¢„Éº„Éâ„ÇíÈÄöÂ∏∏„Å´Êàª„Åô
            setMode('normal');
            
            // „Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞
            updatePreview();
        }

        // „É¢„Éº„ÉâÂàáÊõø
        function setMode(mode) {
            currentMode = mode;
            
            // „Çø„Éñ„Çπ„Çø„Ç§„É´Âà∂Âæ° (Ë®™ÂïèÁêÜÁî±„ÅÆ„Éá„Ç∂„Ç§„É≥„Å´Âêà„Çè„Åõ„Çã)
            const activeClass = "group relative flex flex-col items-center justify-center py-4 rounded-xl border-2 transition-all duration-200 bg-white/70 dark:bg-slate-800/80 font-bold shadow-sm";
            const inactiveClass = "group relative flex flex-col items-center justify-center py-4 rounded-xl border-2 transition-all duration-200 bg-white/40 dark:bg-slate-800/40 border-transparent text-slate-500 dark:text-slate-400 hover:border-slate-300 dark:hover:border-slate-600 hover:bg-white/60";

            // Ëâ≤ÂÆöÁæ©
            const colors = {
                normal: "border-pink-500 text-pink-600 dark:text-pink-400 hover:border-pink-300",
                sms: "border-emerald-500 text-emerald-600 dark:text-emerald-400 hover:border-emerald-300",
                custom: "border-violet-500 text-violet-600 dark:text-violet-400 hover:border-violet-300"
            };

            ['normal', 'sms', 'custom'].forEach(t => {
                const el = document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1));
                if(t === mode) {
                    el.className = `${activeClass} ${colors[t]}`;
                } else {
                    el.className = inactiveClass;
                }
            });

            // „É©„Éô„É´„ÅÆÊõ¥Êñ∞
            const label = document.getElementById('previewLabel');
            if(mode === 'normal') label.textContent = 'ÈÄöÂ∏∏„É°„Éº„É´„Éó„É¨„Éì„É•„Éº';
            else if(mode === 'sms') label.textContent = '‰∫ãÂâçÁ¢∫Ë™çSMS„Éó„É¨„Éì„É•„Éº';
            else label.textContent = 'AI„Éó„É≠„É≥„Éó„Éà„Éó„É¨„Éì„É•„Éº';

            // Â∑¶„Ç´„É©„É†„ÅÆË°®Á§∫Âà∂Âæ°
            const normalSettings = document.getElementById('normalSettings');
            const customSettings = document.getElementById('customSettings');
            const inspectionCard = document.getElementById('inspectionDetailsCard'); // ÁÇπÊ§úÊÉÖÂ†±„Ç´„Éº„Éâ
            
            if (mode === 'custom') {
                normalSettings.classList.add('hidden');
                customSettings.classList.remove('hidden');
                
                // „Ç∞„É≠„ÉºÂäπÊûúÔºöÁ¥´Á≥ª
                document.getElementById('previewGlow').className = "absolute -inset-1 bg-gradient-to-br from-violet-500 to-fuchsia-600 rounded-[20px] opacity-20 blur-xl group-hover:opacity-30 transition duration-1000";
            } else {
                normalSettings.classList.remove('hidden');
                customSettings.classList.add('hidden');
                
                if (mode === 'sms') {
                    // SMS„É¢„Éº„ÉâÔºöÁÇπÊ§úÊÉÖÂ†±„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
                    inspectionCard.classList.add('hidden');
                    
                    // „Ç∞„É≠„ÉºÂäπÊûúÔºöÁ∑ëÁ≥ª
                    document.getElementById('previewGlow').className = "absolute -inset-1 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-[20px] opacity-20 blur-xl group-hover:opacity-30 transition duration-1000";
                } else {
                    // ÈÄöÂ∏∏„É¢„Éº„ÉâÔºöÁÇπÊ§úÊÉÖÂ†±„ÇíË°®Á§∫„Åô„Çã
                    inspectionCard.classList.remove('hidden');

                    // „Ç∞„É≠„ÉºÂäπÊûúÔºö„Éî„É≥„ÇØÁ≥ªÔºàÈÄöÂ∏∏Ôºâ
                    document.getElementById('previewGlow').className = "absolute -inset-1 bg-gradient-to-br from-pink-500 to-violet-600 rounded-[20px] opacity-20 blur-xl group-hover:opacity-30 transition duration-1000";
                }
            }

            updatePreview();
        }

        function updatePreview() {
            const customerName = document.getElementById('customerName').value.trim();
            const staffName = document.getElementById('staffName').value.trim();
            
            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Å®„Éú„Çø„É≥Âà∂Âæ°
            const nameAlert = document.getElementById('nameAlert');
            const alertText = document.getElementById('alertText');
            const copyBtn = document.getElementById('copyBtn');
            
            // „Ç¢„É©„Éº„Éà„ÅÆË°®Á§∫„É≠„Ç∏„ÉÉ„ÇØ
            if (!customerName) {
                alertText.textContent = "È°ßÂÆ¢Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ";
                nameAlert.classList.remove('hidden');
                nameAlert.style.display = 'flex';
                copyBtn.disabled = true;
                copyBtn.classList.add('grayscale');
            } else if (!staffName) {
                alertText.textContent = "ÊãÖÂΩìËÄÖÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ";
                nameAlert.classList.remove('hidden');
                nameAlert.style.display = 'flex';
                copyBtn.disabled = true;
                copyBtn.classList.add('grayscale');
            } else {
                nameAlert.classList.add('hidden');
                nameAlert.style.display = 'none';
                copyBtn.disabled = false;
                copyBtn.classList.remove('grayscale');
            }

            let fullText = "";

            if (currentMode === 'custom') {
                // ==================
                // AI„Éó„É≠„É≥„Éó„ÉàÁîüÊàê„É¢„Éº„Éâ
                // ==================
                const message = document.getElementById('customMessage').value;
                const content = message ? message : 'Ôºà„Åì„Åì„Å´AI„Å´‰ºù„Åà„Åü„ÅÑË¶Å‰ª∂„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ';
                
                fullText = `# ÂëΩ‰ª§
„ÅÇ„Å™„Åü„ÅØ‰ΩèÂÆÖ„É°„Éº„Ç´„Éº„ÅÆ„Ç¢„Éï„Çø„Éº„Çµ„Éù„Éº„ÉàÊãÖÂΩìËÄÖ„Åß„Åô„ÄÇ
„ÅäÂÆ¢Êßò„Å´ÈÄÅ„ÇãÊê∫Â∏ØÈõªË©±„ÅÆ„Ç∑„Éß„Éº„Éà„É°„Éº„É´ÔºàSMS/MMSÔºâ„ÅÆÊñáÈù¢„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

# Âà∂Á¥Ñ
„ÉªÊñáÂ≠óÊï∞„ÅØÊ•µÂäõÁü≠„Åè„ÄÅÁ∞°ÊΩî„Å´ÔºàSMS„ÅÆ„Åü„ÇÅÔºâ„ÄÇ
„ÉªÁ§ºÂÑÄÊ≠£„Åó„Åè„ÄÅ„Åã„Å§Ë¶™„Åó„Åø„ÇÑ„Åô„ÅÑ„Éà„Éº„É≥„Åß„ÄÇ
„Éª„ÄåË¶Å‰ª∂„Äç„ÅåÊòéÁ¢∫„Å´‰ºù„Çè„Çã„Çà„ÅÜ„Å´„ÄÇ
„Éª‰ª∂Âêç„ÅØ‰∏çË¶Å„ÄÇ

# ÂÖ•ÂäõÊÉÖÂ†±
„ÉªÂÆõÂêç: ${customerName} Êßò
„ÉªÂ∑ÆÂá∫‰∫∫: Ê°ßÂÆ∂‰ΩèÂÆÖ ÂüºÁéâÂåóÂ∑•‰∫ãÈÉ® ${staffName}
„ÉªË¶Å‰ª∂/‰ºù„Åà„Åü„ÅÑ„Åì„Å®:
${content}

# Âá∫Âäõ
‰∏ÅÂØß„ÅßË¶™„Åó„Åø„ÇÑ„Åô„ÅÑÊñáÈù¢Ê°à„Çí1„Å§‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
„Ç≥„Éî„Éº„Åó„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„Å´„ÄÅ‰ΩúÊàê„Åó„ÅüÊú¨Êñá„ÅØ„Ç≥„Éº„Éâ„Éñ„É≠„ÉÉ„ÇØÔºà\`\`\`text ... \`\`\`Ôºâ„ÅßÂõ≤„Çì„ÅßÂá∫Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;

            } else if (currentMode === 'sms') {
                // ==================
                // ‰∫ãÂâçÁ¢∫Ë™çSMS„É¢„Éº„Éâ
                // ==================
                const candidateDates = document.getElementById('candidateDates').value;
                
                fullText = `${customerName} Êßò\n\n`;
                fullText += `„ÅÑ„Å§„ÇÇ„Åä‰∏ñË©±„Å´„Å™„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇÊ°ßÂÆ∂‰ΩèÂÆÖ„ÅÆ${staffName}„Åß„Åô„ÄÇ\n\n`;
                fullText += `Ê¨°Âõû„ÅÆË®™ÂïèÊó•Á®ã„ÅÆÁ¢∫Ë™ç„Åß„ÅîÈÄ£Áµ°„ÅÑ„Åü„Åó„Åæ„Åó„Åü„ÄÇ\n`;
                fullText += `‰∫àÂÆöÈÄö„Çä„ÄÅ‰∏ãË®òÊó•ÊôÇ„Å´„Åä‰º∫„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ\n\n`;
                
                fullText += candidateDates.trim() ? `„ÄêÊó•ÊôÇ„Äë\n${candidateDates.trim()}\n\n` : `„ÄêÊó•ÊôÇ„Äë\nÔºàÊó•ÊôÇ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ\n\n`;
                
                fullText += `ÂΩìÊó•„ÅØ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ\n`;
                fullText += `‚ÄªÂ§âÊõ¥„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÅäÊó©„ÇÅ„Å´„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ`;

            } else {
                // ==================
                // ÈÄöÂ∏∏„É°„Éº„É´„É¢„Éº„Éâ
                // ==================
                const inspectionTypeSelect = document.getElementById('inspectionType').value;
                const customInspectionType = document.getElementById('customInspectionType').value;
                let type = inspectionTypeSelect === '„Åù„ÅÆ‰ªñ' ? customInspectionType : inspectionTypeSelect;
                type = type.trim();
                if (type && !type.includes('ÁÇπÊ§ú')) type += 'ÁÇπÊ§ú';

                const issueDetail = document.getElementById('issueDetail').value;
                const needsApology = document.getElementById('needsApology').checked;
                const visitReason = document.querySelector('input[name="visitReason"]:checked').value;
                const candidateDates = document.getElementById('candidateDates').value;

                const greeting = `„ÅÑ„Å§„ÇÇÂ§ßÂ§â„Åä‰∏ñË©±„Å´„Å™„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇ\nÊ°ßÂÆ∂‰ΩèÂÆÖ ÂüºÁéâÂåóÂ∑•‰∫ãÈÉ®„ÅÆ${staffName}„Åß„Åô„ÄÇ`;

                let mainBody = '';
                if (type) mainBody += `ÂÖàÊó•„ÅØ„ÄÅ${type}„Å´„ÅäÁ´ã‰ºö„ÅÑ„ÅÑ„Åü„Å†„Åç„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„ÄÇ\n`;
                if (issueDetail) {
                    mainBody += `„ÅîÊåáÊëò„ÅÑ„Åü„Å†„Åç„Åæ„Åó„Åü${issueDetail}„ÅÆ‰ª∂„Å´„Å§„ÅÑ„Å¶„ÅîÈÄ£Áµ°„ÅÑ„Åü„Åó„Åæ„Åó„Åü„ÄÇ\n`;
                }
                
                if (needsApology) {
                    mainBody += issueDetail ? `ÁÇπÊ§úÊó•„Åã„Çâ„ÅäÊôÇÈñì„Çí„ÅÑ„Åü„Å†„ÅÑ„Å¶„Åó„Åæ„ÅÑ„ÄÅË™†„Å´Áî≥„ÅóË®≥„Åî„Åñ„ÅÑ„Åæ„Åõ„Çì„ÄÇ\n` : `„ÅîÈÄ£Áµ°„ÅåÈÅÖ„Åè„Å™„Çä„Åæ„Åó„Å¶„ÄÅË™†„Å´Áî≥„ÅóË®≥„Åî„Åñ„ÅÑ„Åæ„Åõ„Çì„ÄÇ\n`;
                }

                const reasonText = visitReason === 'ÁèæÂú∞Ë™øÊüª' ? 'Áä∂Ê≥ÅÁ¢∫Ë™çÔºàÁèæÂú∞Ë™øÊüªÔºâ' : '‰øÆÁπï‰ΩúÊ•≠';
                let proposal = `„Å§„Åç„Åæ„Åó„Å¶„ÅØ„ÄÅ‰∏ãË®òÊó•Á®ã„Å´„Å¶${reasonText}„Å´„Åä‰º∫„ÅÑ„Åó„Åü„ÅèÂ≠ò„Åò„Åæ„Åô„ÄÇ\n\n`;

                if (candidateDates.trim()) {
                    proposal += `„ÄêÂÄôË£úÊó•ÊôÇ„Äë\n${candidateDates.trim()}\n\n`;
                    proposal += `‰∏äË®ò‰ª•Â§ñ„Åß„ÇÇ„ÄÅÁÅ´„ÉªÊ∞¥„ÇíÈô§„ÅèÂπ≥Êó•„ÉªÂúüÊó•„ÅÆ9ÊôÇÔΩû17ÊôÇ„ÅÆÈñì„ÅßË™øÊï¥ÂèØËÉΩ„Åß„Åô„ÄÇ\n„ÅîÈÉΩÂêà„ÅØ„ÅÑ„Åã„Åå„Åß„Åó„Çá„ÅÜ„Åã„ÄÇ`;
                } else {
                    proposal += `ÊÅê„ÇåÂÖ•„Çä„Åæ„Åô„Åå„ÄÅÁÅ´„ÉªÊ∞¥„ÇíÈô§„ÅèÂπ≥Êó•„ÉªÂúüÊó•„ÅÆ9ÊôÇÔΩû17ÊôÇ„ÅÆÈñì„Åß„ÄÅ\n„ÅîÈÉΩÂêà„ÅÆ„Çà„Çç„Åó„ÅÑÊó•Á®ã„Çí3„Å§„Åª„Å©„ÅäÁü•„Çâ„Åõ„ÅÑ„Åü„Å†„Åë„Åæ„Åô„Åß„Åó„Çá„ÅÜ„Åã„ÄÇ`;
                }

                fullText = `${customerName} Êßò\n\n${greeting}\n\n${mainBody}\n${proposal}\n\n‰ΩïÂçí„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑÁî≥„Åó‰∏ä„Åí„Åæ„Åô„ÄÇ\n\nÊ°ßÂÆ∂‰ΩèÂÆÖ ÂüºÁéâÂåóÂ∑•‰∫ãÈÉ® ${staffName}`;
            }

            document.getElementById('generatedText').value = fullText;
        }

        // „Åù„ÅÆ‰ªñÊ©üËÉΩ
        function toggleCustomInspection() {
            const val = document.getElementById('inspectionType').value;
            const wrapper = document.getElementById('customInspectionWrapper');
            val === '„Åù„ÅÆ‰ªñ' ? wrapper.classList.remove('hidden') : wrapper.classList.add('hidden');
        }

        function addCandidateDate() {
            const dateVal = document.getElementById('dateInput').value;
            const timeVal = document.getElementById('timeInput').value;
            if (!dateVal) return;
            const date = new Date(dateVal);
            const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const formatted = `„Éª${date.getMonth() + 1}Êúà${date.getDate()}Êó•(${days[date.getDay()]}) ${timeVal}ÔΩû`;
            const area = document.getElementById('candidateDates');
            area.value = area.value ? area.value.trim() + '\n' + formatted + '\n' : formatted + '\n';
            updatePreview();
            toggleClearBtn();
        }

        document.getElementById('dateInput').addEventListener('input', (e) => {
            const btn = document.getElementById('addBtn');
            btn.disabled = !e.target.value;
            if(!e.target.value) btn.classList.add('opacity-50', 'cursor-not-allowed');
            else btn.classList.remove('opacity-50', 'cursor-not-allowed');
        });

        function toggleClearBtn() {
            const val = document.getElementById('candidateDates').value;
            const btn = document.getElementById('clearBtn');
            val ? btn.classList.remove('hidden') : btn.classList.add('hidden');
        }

        function clearCandidates() {
            document.getElementById('candidateDates').value = '';
            updatePreview();
            toggleClearBtn();
        }

        // „Ç≥„Éî„ÉºÊ©üËÉΩÔºö‰∫íÊèõÊÄß„ÅÆÈ´ò„ÅÑÂÆüË£Ö
        function handleCopy() {
            const text = document.getElementById('generatedText').value;
            
            // 1. „Åæ„ÅöexecCommand („Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ) „ÇíË©¶Ë°å
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopiedState();
                } else {
                    throw new Error('execCommand failed');
                }
            } catch (err) {
                console.warn('execCommand copy failed, trying Clipboard API', err);
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text)
                        .then(showCopiedState)
                        .catch(e => {
                            console.error('Clipboard API failed', e);
                            alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊâãÂãï„Åß„Ç≥„Éî„Éº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        });
                }
            } finally {
                document.body.removeChild(textArea);
            }
        }

        function showCopiedState() {
            const btn = document.getElementById('copyBtn');
            const btnText = document.getElementById('copyBtnText');
            btn.classList.add('bg-emerald-500', 'text-white', 'scale-110', 'ring-emerald-200');
            btn.classList.remove('from-pink-500', 'to-violet-600', 'ring-white/30');
            
            // „Ç¢„Ç§„Ç≥„É≥Â§âÊõ¥
            const icon = btn.querySelector('svg');
            const originalIcon = icon.innerHTML;
            icon.innerHTML = '<polyline points="20 6 9 17 4 12"></polyline>'; // Check icon
            btnText.textContent = "COPIED!";
            
            setTimeout(() => {
                btn.classList.remove('bg-emerald-500', 'text-white', 'scale-110', 'ring-emerald-200');
                btn.classList.add('from-pink-500', 'to-violet-600', 'ring-white/30');
                icon.innerHTML = '<rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>'; // Restore icon
                btnText.textContent = "COPY";
            }, 2000);
        }

        // ÂàùÊúüÂÆüË°å
        updatePreview();
    </script>
</body>
</html>
